:root {
  --c-bg: #0b0f1a;
  --c-text: #e9f0ff;
  --c-accent: #7cf0ff;
  --c-glass: rgba(20, 30, 50, 0.85);
  --c-border: rgba(124, 240, 255, 0.3);
  --z-field: 10;
  --z-ui: 20;
  --z-talk-char: 50;
  --z-talk-win: 60;
  --z-overlay: 100;
}

body {
  margin: 0;
  background-color: var(--c-bg);
  color: var(--c-text);
  font-family: sans-serif;
  overflow: hidden;
  user-select: none;
}

#app { position: fixed; inset: 0; background: #000; }

/* Scenes */
.scene {
  position: absolute; inset: 0;
  opacity: 0; pointer-events: none; transition: opacity 0.5s;
  display: flex; flex-direction: column; align-items: center;
}
.scene.is-active { opacity: 1; pointer-events: auto; }

/* Field */
#field-area {
  position: absolute; inset: 0;
  background: url("assets/bg_field.jpg") no-repeat center center;
  background-size: cover;
}

/* NPC (SD Character) */
.npc {
  position: absolute;
  width: 88px; height: 88px;
  transform: translate(-50%, -50%);
  cursor: pointer;
  z-index: 10;
  filter: drop-shadow(0 0 10px rgba(124, 240, 255, 0.8));
  transition: transform 0.2s, filter 0.3s;
}

.npc:active { transform: translate(-50%, -50%) scale(0.9); }
.npc img { width: 100%; height: 100%; object-fit: contain; }

/* ゲート (クリア時出現) */
.gate {
  position: absolute;
  width: 120px; height: 120px;
  transform: translate(-50%, -50%);
  cursor: pointer;
  z-index: 5;
  filter: drop-shadow(0 0 15px cyan);
  animation: spin 10s linear infinite;
}

/* ★修正: 出現アニメーション */
.gate.fade-in {
  animation: spin 10s linear infinite, fadeIn 2s ease-out forwards;
}

@keyframes spin { 
  0% { transform: translate(-50%, -50%) rotate(0deg); } 
  100% { transform: translate(-50%, -50%) rotate(360deg); } 
}

@keyframes fadeIn {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5) rotate(0deg); }
  100% { opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(0deg); } 
  /* 注意: rotateの値はspinと競合するため、spinの親要素を作るか、単純なopacityフェードにするのが無難ですが、今回は単純化のためこのままにします */
}

/* Title & Menu */
#scene-title { justify-content: center; background: rgba(0,0,0,0.5); z-index: 30; }
.title-container h1 { font-size: 3rem; color: var(--c-accent); text-shadow: 0 0 10px var(--c-accent); margin:0; }
.game-subtitle { color: #fff; letter-spacing: 0.2em; opacity: 0.7; }
.menu { margin-top: 40px; display: flex; flex-direction: column; gap: 16px; width: 220px; }
.btn {
  padding: 12px; background: rgba(0,0,0,0.6); border: 1px solid var(--c-accent);
  color: var(--c-accent); font-weight: bold; cursor: pointer; border-radius: 8px;
}
.btn.danger { color: #ff6b6b; border-color: #ff6b6b; }

/* Talk Overlay */
.overlay {
  position: absolute; inset: 0; background: rgba(0,0,0,0.6);
  z-index: var(--z-overlay); opacity: 0; pointer-events: none; transition: opacity 0.3s;
}
.overlay.is-active { opacity: 1; pointer-events: auto; }

/* 立ち絵エリア */
#talk-char-area {
  position: absolute; bottom: 0; right: 0; width: 100%; height: 100%;
  pointer-events: none; z-index: var(--z-talk-char);
  display: flex; align-items: flex-end; justify-content: flex-end;
}
#talk-char-img {
  max-height: 85%; max-width: 60%;
  margin-right: 5%; object-fit: contain;
  filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
}

/* ウィンドウエリア */
.talk-window {
  position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
  width: 90%; max-width: 800px; height: 180px;
  z-index: var(--z-talk-win);
  padding: 24px 40px;
  background: url("assets/ui_window.png") no-repeat center center;
  background-size: 100% 100%; /* 枠の歪みが気になる場合は border-image を検討してください */
  color: #fff;
  text-shadow: 1px 1px 2px #000;
}
.talk-header { font-size: 1.2rem; color: var(--c-accent); margin-bottom: 8px; font-weight: bold;}
.talk-body { font-size: 1rem; line-height: 1.6; height: 80px; }
.talk-footer { text-align: right; margin-top: 4px; }
.blink-text { font-size: 0.8rem; animation: blink 1.5s infinite; opacity: 0.7; }
@keyframes blink { 50% { opacity: 0.2; } }

/* Collection */
#scene-collection { background: rgba(10,15,20,0.95); padding: 40px; }
.scroll-view { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px; overflow-y: auto; height: 80%; }
.card { background: rgba(255,255,255,0.05); border: 1px solid #444; padding: 16px; border-radius: 8px; }
.card.locked { opacity: 0.3; }
.card-title { color: var(--c-accent); font-weight: bold; margin-bottom: 8px; }
.card-text { font-size: 0.85rem; white-space: pre-wrap; }
